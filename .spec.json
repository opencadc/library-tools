{
  "$defs": {
    "Build": {
      "additionalProperties": false,
      "description": "Configuration for building the container image.",
      "properties": {
        "path": {
          "default": ".",
          "description": "Directory containing the Dockerfile.",
          "examples": [
            ".",
            "images/base"
          ],
          "title": "Path",
          "type": "string"
        },
        "dockerfile": {
          "default": "Dockerfile",
          "description": "Dockerfile.",
          "examples": [
            "Dockerfile",
            "base.Dockerfile"
          ],
          "title": "Dockerfile",
          "type": "string"
        },
        "context": {
          "default": ".",
          "description": "Build context relative to path.",
          "examples": [
            ".",
            "../"
          ],
          "title": "Build Context",
          "type": "string"
        },
        "builder": {
          "default": "buildkit",
          "description": "Builder backend used for this entry.",
          "examples": [
            "buildkit"
          ],
          "title": "Build Backend",
          "type": "string"
        },
        "platforms": {
          "default": [
            "linux/amd64"
          ],
          "description": "Target platforms.",
          "examples": [
            [
              "linux/amd64"
            ],
            [
              "linux/amd64",
              "linux/arm64"
            ]
          ],
          "items": {
            "enum": [
              "linux/amd64",
              "linux/arm64"
            ],
            "type": "string"
          },
          "title": "Target Platforms",
          "type": "array"
        },
        "tags": {
          "description": "Image tags.",
          "examples": [
            "latest",
            "1.0.0"
          ],
          "items": {
            "type": "string"
          },
          "title": "Container Image Tags",
          "type": "array"
        },
        "args": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Build-time variables.",
          "examples": [
            {
              "foo": "bar"
            }
          ],
          "title": "Build Args"
        },
        "annotations": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Annotations for the image.",
          "examples": [
            {
              "canfar.image.runtime": "python",
              "canfar.image.type": "runtime"
            }
          ],
          "title": "Image Annotations"
        },
        "labels": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Labels for the image.",
          "examples": [
            {
              "org.opencontainers.image.description": "Base image for CANFAR Science Platform",
              "org.opencontainers.image.title": "CANFAR Base Image"
            }
          ],
          "title": "Image Labels"
        },
        "target": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target stage to build.",
          "examples": [
            "runtime"
          ],
          "title": "Build Target"
        },
        "test": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Test cmd to verify the image.",
          "examples": [
            "bash -c 'echo hello world'",
            "bash -c ./test.sh"
          ],
          "title": "Test Command"
        },
        "renovation": {
          "default": false,
          "description": "When true, canfar library will open prs to update dockerfile dependencies.",
          "examples": [
            true,
            false
          ],
          "title": "Enable Renovate",
          "type": "boolean"
        }
      },
      "required": [
        "tags"
      ],
      "title": "Build",
      "type": "object"
    },
    "Git": {
      "additionalProperties": false,
      "description": "Repository information for the image build source.",
      "properties": {
        "repo": {
          "description": "Git repository.",
          "examples": [
            "https://github.com/opencadc/canfar-library"
          ],
          "format": "uri",
          "minLength": 1,
          "title": "Repository",
          "type": "string"
        },
        "fetch": {
          "default": "refs/heads/main",
          "description": "Git fetch reference.",
          "examples": [
            "refs/heads/main",
            "refs/heads/develop"
          ],
          "title": "Git Fetch Reference",
          "type": "string"
        },
        "commit": {
          "description": "SHA commit hash to build.",
          "examples": [
            "1234567890123456789012345678901234567890"
          ],
          "title": "SHA Commit Hash",
          "type": "string"
        }
      },
      "required": [
        "repo",
        "commit"
      ],
      "title": "Git",
      "type": "object"
    },
    "Maintainer": {
      "additionalProperties": false,
      "description": "Details about the maintainer of the image.",
      "properties": {
        "name": {
          "description": "Name of the maintainer.",
          "title": "Name",
          "type": "string"
        },
        "email": {
          "description": "Contact email.",
          "title": "Email",
          "type": "string"
        },
        "github": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "GitHub Username.",
          "title": "GitHub Username"
        },
        "gitlab": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "GitLab Username.",
          "title": "GitLab Username"
        }
      },
      "required": [
        "name",
        "email"
      ],
      "title": "Maintainer",
      "type": "object"
    },
    "Metadata": {
      "additionalProperties": false,
      "description": "Metadata for the image.",
      "properties": {
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Stylized name for the image.",
          "examples": [
            "Python",
            "astroML",
            "NumPy"
          ],
          "title": "Display Name"
        },
        "description": {
          "anyOf": [
            {
              "maxLength": 255,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Short description of the image.",
          "examples": [
            "Python runtime for CANFAR Science Platform"
          ],
          "title": "Description"
        },
        "homepage": {
          "anyOf": [
            {
              "format": "uri",
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "URL to the homepage for the image.",
          "examples": [
            "https://canfar.net"
          ],
          "title": "Homepage"
        },
        "guide": {
          "anyOf": [
            {
              "format": "uri",
              "minLength": 1,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "URL to the user guide for the image.",
          "examples": [
            "https://canfar.net/docs/user-guide"
          ],
          "title": "User Guide"
        },
        "categories": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Categories for the image.",
          "examples": [
            "development",
            "science",
            "astronomy"
          ],
          "title": "Categories"
        },
        "tools": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Tools provided by the image.",
          "examples": [
            "python",
            "jupyter",
            "notebook"
          ],
          "title": "Tools"
        }
      },
      "title": "Metadata",
      "type": "object"
    },
    "Registry": {
      "additionalProperties": false,
      "description": "Details about the container registry.",
      "properties": {
        "host": {
          "const": "https://images.canfar.net",
          "default": "https://images.canfar.net",
          "description": "Container registry hostname.",
          "examples": [
            "https://docker.io"
          ],
          "title": "Hostname",
          "type": "string"
        },
        "project": {
          "default": "library",
          "description": "Container registry namespace.",
          "enum": [
            "library",
            "srcnet",
            "skaha"
          ],
          "examples": [
            "skaha"
          ],
          "title": "Project",
          "type": "string"
        },
        "image": {
          "description": "Container image name.",
          "examples": [
            "python",
            "base"
          ],
          "title": "Image Name",
          "type": "string"
        }
      },
      "required": [
        "image"
      ],
      "title": "Registry",
      "type": "object"
    }
  },
  "$id": "https://raw.githubusercontent.com/opencadc/canfar-library/main/.spec.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "description": "Schema to capture ownership, build source, intent, and identity for library artifacts.",
  "properties": {
    "registry": {
      "$ref": "#/$defs/Registry",
      "description": "Image registry."
    },
    "maintainers": {
      "description": "Image maintainers.",
      "items": {
        "$ref": "#/$defs/Maintainer"
      },
      "title": "Maintainers",
      "type": "array"
    },
    "git": {
      "$ref": "#/$defs/Git",
      "description": "Image repository.",
      "title": "Git Info"
    },
    "build": {
      "$ref": "#/$defs/Build",
      "description": "Image build info.",
      "title": "Build Info"
    },
    "metadata": {
      "$ref": "#/$defs/Metadata",
      "description": "Image metadata."
    }
  },
  "required": [
    "registry",
    "maintainers",
    "git",
    "build",
    "metadata"
  ],
  "title": "CANFAR Container Library Schema",
  "type": "object"
}
